						SALESMAN DATABASE

CREATE TABLE SALESMAN
(SALESMAN_ID INTEGER,
NAME VARCHAR(20),
CITY VARCHAR(20),
COMMISSION VARCHAR(20),
PRIMARY KEY(SALESMAN_ID));

DESC SALESMAN;

CREATE TABLE CUSTOMER(CUSTOMER_ID INTEGER PRIMARY KEY
,CUST_NAME VARCHAR(20),
CITY VARCHAR(20),GRADE  INTEGER,
SALESMAN_ID INTEGER,
FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN(SALESMAN_ID) ON DELETE SET NULL);

DESC CUSTOMER;

CREATE TABLE ORDERS(ORDER_NO INTEGER PRIMARY KEY,PURCHASE_AMOUNT DECIMAL(10,2),ORDER_DATE DATE,
CUSTOMER_ID INTEGER, SALESMAN_ID INTEGER,FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID) ON DELETE CASCADE,FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN(SALESMAN_ID) ON DELETE CASCADE);

DESC ORDERS;

INSERT INTO SALESMAN VALUES(1000,'RAHUL','BANGALORE','20%');
INSERT INTO SALESMAN VALUES(2000,'ANKITA','BANGALORE','25%');
INSERT INTO SALESMAN VALUES(3000,'SHARMA','MYSORE','30%');
INSERT INTO SALESMAN VALUES(4000,'ANJALI','DELHI','15%');
INSERT INTO SALESMAN VALUES(5000,'RAJ','HYDERABAD','15%');

 SELECT * FROM SALESMAN;

INSERT INTO CUSTOMER VALUES(1,'ADYA','BANGALORE',100,1000);
INSERT INTO CUSTOMER VALUES(2,'BANU','BANGALORE',300,1000);
INSERT INTO CUSTOMER VALUES(3,'CHETHAN','CHENNAI',400,2000);
INSERT INTO CUSTOMER VALUES(4,'DANISH','BANGALORE',200,2000);
INSERT INTO CUSTOMER VALUES(5,'ESHA','BANGALORE',400,3000);

SELECT * FROM CUSTOMER;

INSERT INTO ORDERS VALUES(201,5000,'2020-06-02',1,1000);
INSERT INTO ORDERS VALUES(202,450,'2020-04-09',1,2000);
INSERT INTO ORDERS VALUES(203,1000,'2020-03-15',3,2000);
INSERT INTO ORDERS VALUES(204,3500,'2020-07-09',4,3000);
INSERT INTO ORDERS VALUES(205,550,'2020-05-05',2,2000);


SELECT * FROM ORDERS;




SELECT GRADE,COUNT(DISTINCT CUSTOMER_ID)
 FROM CUSTOMER 
GROUP BY GRADE
 HAVING GRADE>(SELECT AVG(GRADE)
 FROM CUSTOMER 
WHERE CITY='BANGALORE');



SELECT SALESMAN_ID, NAME
 FROM SALESMAN A 
WHERE 1<(SELECT COUNT(*) 
FROM CUSTOMER 
WHERE SALESMAN_ID=A.SALESMAN_ID);




SELECT SALESMAN.SALESMAN_ID,NAME,CUST_NAME, COMMISSION
FROM SALESMAN, CUSTOMER
WHERE SALESMAN.CITY = CUSTOMER.CITY
UNION
SELECT SALESMAN_ID,NAME, 'NO MATCH', COMMISSION
FROM SALESMAN
WHERE NOT CITY= ANY (SELECT CITY FROM CUSTOMER)
ORDER BY 2 DESC;



CREATE VIEW ELITSALESMAN AS
SELECT B.ORDER_DATE,A.SALESMAN_ID,A.NAME
FROM SALESMAN A,ORDERS B
WHERE A.SALESMAN_ID=B.SALESMAN_ID
AND B.PURCHASE_AMOUNT=(SELECT MAX(PURCHASE_AMOUNT)
FROM ORDERS C
WHERE C.ORDER_DATE=B.ORDER_DATE);

SELECT * FROM ELITSALESMAN;


DELETE FROM SALESMAN
WHERE SALESMAN_ID=1000;

SELECT * FROM SALESMAN;
							  














					MOVIE DATABASE
USE MOVIE;

CREATE TABLE ACTOR (
    ACT_ID INTEGER PRIMARY KEY,
    ACT_NAME VARCHAR(20),
    ACT_GENDER CHAR(1));

DESC ACTOR;

CREATE TABLE DIRECTOR (
    DIR_ID INTEGER PRIMARY KEY,
    DIR_NAME VARCHAR(20),
    DIR_PHONE VARCHAR(15)
);

DESC  DIRECTOR;



CREATE TABLE MOVIES (
    MOV_ID INTEGER PRIMARY KEY,
    MOV_TITLE VARCHAR(25),
    MOV_YEAR INTEGER,
    MOV_LANG VARCHAR(12),
    DIR_ID INTEGER,
    FOREIGN KEY (DIR_ID) REFERENCES DIRECTOR(DIR_ID)
);


DESC MOVIES;


CREATE TABLE MOVIECAST (
    ACT_ID INTEGER,
    MOV_ID INTEGER,
    ROLE VARCHAR(10),
    PRIMARY KEY (ACT_ID, MOV_ID),
    FOREIGN KEY (ACT_ID) REFERENCES ACTOR(ACT_ID),
    FOREIGN KEY (MOV_ID) REFERENCES MOVIES(MOV_ID)
);


DESC MOVIECAST;


CREATE TABLE RATING(
MOV_ID INTEGER, 
REVSTARS VARCHAR(25),
PRIMARY KEY(MOV_ID),
FOREIGN KEY (MOV_ID) REFERENCES MOVIES(MOV_ID));

DESC RATING;


INSERT INTO ACTOR VALUES(301,'ANUSHKA', 'F');
INSERT INTO ACTOR VALUES(302,' PRABHAS', 'M');
INSERT INTO ACTOR VALUES(303,' PUNITH','M');
INSERT INTO ACTOR VALUES(304 ,'SUDEEP', 'M');


SELECT * FROM ACTOR;


INSERT INTO DIRECTOR VALUES(60, 'RAJAMOULI',919);
INSERT INTO DIRECTOR VALUES(61, 'HITCHCOCK',818);
INSERT INTO DIRECTOR VALUES(62, 'FARAN',717);
INSERT INTO DIRECTOR VALUES(63,'STEVEN SPIELBERG',616);

SELECT * FROM DIRECTOR;


INSERT INTO MOVIES VALUES(1001,'BAHUBALI-2',2017, 'TELUGU',60);
INSERT INTO MOVIES VALUES(1002, 'BAHUBALI-1',2015, 'TELUGU',60);
INSERT INTO MOVIES VALUES(1003,'AKASH',2008, 'KANNADA', 61);
INSERT INTO MOVIES VALUES(1004,'WAR HORSE',2011,'ENGLISH',63);



SELECT * FROM MOVIES;


INSERT INTO MOVIECAST VALUES(301,1002, 'HEROINE');
INSERT INTO MOVIECAST VALUES(301,1001, 'HEROINE');
INSERT INTO MOVIECAST VALUES(303,1003,'HERO');
INSERT INTO MOVIECAST VALUES(303,1002, 'GUEST');
INSERT INTO MOVIECAST VALUES(304,1004,'HERO');


SELECT * FROM MOVIECAST;

INSERT INTO RATING VALUES(1001,4);
INSERT INTO RATING VALUES 1002,2);
INSERT INTO RATING VALUES(1003,5);
INSERT INTO RATING VALUES(1004,4);

SELECT * FROM RATING;


SELECT M.MOV_TITLE
FROM MOVIES M
JOIN MOVIECAST MV ON M.MOV_ID = MV.MOV_ID
WHERE MV.ACT_ID IN (
    SELECT ACT_ID 
    FROM MOVIECAST  
    GROUP BY ACT_ID
    HAVING COUNT(*) > 1
)
GROUP BY M.MOV_TITLE
HAVING COUNT(*) > 1;



SELECT A.ACT_NAME, C.MOV_TITLE, C.MOV_YEAR
FROM ACTOR A
JOIN MOVIECAST B ON A.ACT_ID = B.ACT_ID
JOIN MOVIES C ON B.MOV_ID = C.MOV_ID
WHERE C.MOV_YEAR NOT BETWEEN 2000 AND 2005;



SELECT MOV_TITLE, MAX(REVSTARS) AS MAX_RATING
FROM MOVIES
INNER JOIN RATING USING (MOV_ID)
GROUP BY MOV_TITLE
HAVING MAX(REVSTARS) > 0
ORDER BY MOV_TITLE;


UPDATE RATING 
SET REVSTARS = 5
WHERE MOV_ID IN (
    SELECT MOV_ID 
    FROM MOVIES 
    WHERE DIR_ID IN (
        SELECT DIR_ID 
        FROM DIRECTOR 
        WHERE DIR_NAME = 'STEVEN SPIELBERG')
);

SELECT * FROM RATING;


